{% extends 'layout.html.twig' %}

{% set adminMenu = true %}

{% block title %}
    {{ title }}
{% endblock %}

{% block content %}
    <h2 class="text-center">{{ block('title') }}</h2>

    {% for flashMessage in app.session.flashbag.get('success') %}
    <div class="alert alert-success" id="msgAlerte">
        {{ flashMessage }}
    </div>
    {% endfor %}

    <div class="well">
    {{ form_start(episodeForm, { 'attr': {
                'class': 'form-horizontal',
                'onsubmit': 'return valider()',
                'id': 'eForm'
            }}) }}
        <div class="form-group">
            {{ form_label(episodeForm.titre, null, { 'label_attr':  {
                'class': 'col-sm-2 control-label'
            }}) }}
            <div class="col-sm-10">
                {{ form_errors(episodeForm.titre) }}
                {{ form_widget(episodeForm.titre, { 'attr':  {
                    'class': 'form-control'
                }}) }}
            </div>
        </div>
        <div class="form-group">
            {{ form_label(episodeForm.contenu, null, { 'label_attr':  {
                'class': 'col-sm-2 control-label'
            }}) }}
            <div class="col-sm-10">
                {{ form_errors(episodeForm.contenu) }}
                {{ form_widget(episodeForm.contenu) }}
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-offset-4 col-sm-3">
                <input type="submit" formnovalidate="true"  class="btn btn-primary btn-episode" value="Enregistrer" />
            </div>
        </div>
    {{ form_end(episodeForm) }}

    </div>
{% endblock %}

{% block javascript %}
    {{parent()}}
    <script>
        tinymce.init({
            selector: "textarea",
            height: "480"
        });
        // console.log('Je passe dans le block javascript dans tiny');
    </script>

    <script type="text/javascript">
        console.log('Je passe dans le block javascript dans valider()');
        function valider(){
            // Déclaration des variables
            var titrEpi = document.getElementById('episode_titre');
            var valTirEpi = titrEpi.value;
            var contEpi = tinyMCE.get('episode_contenu').getContent();

            // Traitement
            if (!valTirEpi || !contEpi) {
                console.log ('Contenu de la variable valTriEpi pendant test : ' + valTirEpi);
                console.log ('Contenu de la variable contEpi pendant test : ' + contEpi);
                // Mettre un message d'avertissement ICI //
                alert('Infos blog : \n\nVous devez saisir : \n1 Titre\n&\n1 Contenu \npour que l\'épisode soit enregistré.');
                // debugger;
                // $("#msgAlerte").html("Vous devez saisir : 1 Titre & 1 Contenu pour que l\'épisode soit enregistré.");
                // debugger;
                return false;

            } else{
                console.log ('Le titre est devenu : ' + valTirEpi);
                console.log ('Le contenu est devenu : ' + contEpi);
                return true;
            }
        }

    </script>
{% endblock javascript%}
